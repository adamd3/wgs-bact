nextflow_workflow {

    name "Test workflow: sra/main.nf"
    script "workflows/sra/main.nf"
    workflow "SRA"
    tag "workflows"
    tag "workflows_sra"
    tag "sra_custom_ena_metadata_fields"

    test("Parameters: --nf_core_pipeline rnaseq --ena_metadata_fields ... --sample_mapping_fields ...") {

        when {
            workflow {
                """
                input[0] = Channel.from('DRR026872','DRR028935','ERR1109373','ERR1160846','GSE214215','GSM4907283','SRR12848126','SRR13191702','SRR14593545','SRR14709033','SRR9984183')
                """
            }
            params {
                outdir = "$outputDir"
                nf_core_pipeline = "rnaseq"
                ena_metadata_fields = "run_accession,experiment_accession,library_layout,fastq_ftp,fastq_md5"
                sample_mapping_fields = "run_accession,library_layout"
            }
        }

        then {
            assertAll(
                { assert workflow.success },
//                { assert snapshot(workflow.out).match() }
                { assert new File("$outputDir/custom").exists() },
                { assert new File("$outputDir/metadata").exists() },
                { assert new File("$outputDir/pipeline_info").exists() },
                { assert new File("$outputDir/samplesheet").exists() },
                { assert snapshot(path("$outputDir/fastq/").list()).match("fastq") }
            )
        }
    }
}
